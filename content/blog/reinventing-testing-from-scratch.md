---
title: "ä»é›¶å®ç°ä¸€ä¸ªæµ‹è¯•æ¡†æ¶ï¼šHope é¡¹ç›®å®è·µè®°å½•"
date: 2025-07-16T19:33:26+08:00
draft: false
author: "NebulaNova"
tags: ["Tech", "Testing"]
categories: ["Blog"]
series: ["Blog"]
description: "ä¸€ç¯‡è®°å½•å¦‚ä½•ä»é›¶å®ç° JavaScript å•å…ƒæµ‹è¯•æ¡†æ¶ Hope çš„å·¥ç¨‹å®å½•ï¼Œæ¶µç›–è®¾è®¡åŠ¨æœºã€æ¨¡å—åˆ’åˆ†ã€é’©å­æœºåˆ¶ã€æ‰§è¡Œé¡ºåºã€æ¶æ„æ€è€ƒç­‰æ ¸å¿ƒå†…å®¹"
featured: false
toc: true
---

# ä»é›¶å®ç°ä¸€ä¸ªæµ‹è¯•æ¡†æ¶ï¼šHope é¡¹ç›®å®è·µè®°å½•

## ç¼˜èµ·

ä¸ºä»€ä¹ˆè¦è‡ªå·±å®ç°ä¸€ä¸ªæµ‹è¯•æ¡†æ¶ï¼Ÿ

> é˜…è¯»äº† [ã€Šé‡æ–°é€ è½®å­ç³»åˆ—(ä¸€)ï¼šå•å…ƒæµ‹è¯•æ¡†æ¶ã€‹](https://ramsayleung.github.io/zh/post/2025/reinvent_unit_test/)ã€‚è¿™ä¸ªé¡¹ç›®æ˜¯è¿™ä¸ªæ–‡ç« çš„å®è·µï¼Œå› ä¸ºæœ¬äººä¹Ÿç”¨è¿‡ Jest å’Œ Mocha ï¼Œäº†è§£è¿™ä¸¤ä¸ªæµ‹è¯•æ¡†æ¶çš„åŠŸèƒ½ï¼Œæ‰€ä»¥å°è¯•è‡ªå·±å®ç°ä¸€ä¸ªæ–°çš„æµ‹è¯•æ¡†æ¶ï¼Œå¹¶æ²¡æœ‰è§£å†³å…¶ä»–ç—›ç‚¹ï¼Œä¸ºäº†å­¦ä¹  js ä»£ç å’ŒCLIæ¶æ„ã€‚

## é¡¹ç›®ç›®å½•ç»“æ„æ¦‚è§ˆ

```
hope-test/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ hope.ts      // æ ¸å¿ƒæµ‹è¯•æ¡†æ¶å®ç°
â”‚   â””â”€â”€ pray.ts      // å‘½ä»¤è¡Œå·¥å…·å±‚
â”œâ”€â”€ tests/           // æµ‹è¯•ç”¨ä¾‹
â”œâ”€â”€ package.json
```

* `hope.ts`: æµ‹è¯•æ¡†æ¶æ ¸å¿ƒï¼Œè´Ÿè´£æµ‹è¯•æ³¨å†Œã€é’©å­æ‰§è¡Œã€æ–­è¨€ã€é”™è¯¯åˆ†ç±»ç­‰é€»è¾‘
* `pray.ts`: CLI å…¥å£ï¼Œè´Ÿè´£å‚æ•°è§£æã€ç»“æœå±•ç¤ºã€æŠ¥å‘Šç”Ÿæˆ

## æ ¸å¿ƒè®¾è®¡ç†å¿µ

### Hope ç±»

æ ¸å¿ƒå±æ€§åŒ…æ‹¬ï¼š

* `suites`ï¼šå®Œæ•´çš„æµ‹è¯•å¥—ä»¶æ ‘ç»“æ„
* `currentSuite`ï¼šå½“å‰æ­£åœ¨æ³¨å†Œçš„å¥—ä»¶
* `passes / fails / errors`ï¼šæ‰§è¡Œç»“æœåˆ†ç±»

### æµ‹è¯•æ³¨å†Œæœºåˆ¶

æµ‹è¯•æ–‡ä»¶ä¸­æ³¨å†Œç”¨ä¾‹çš„åŸºæœ¬å½¢å¼å¦‚ä¸‹ï¼š

```ts
import { test } from '../src/hope';
test('my first test', () => {
  // some logic
});
```

è¿™äº›æ³¨å†Œä»£ç åœ¨â€œåŠ è½½æ¨¡å—ç¬é—´â€å³è¢«æ‰§è¡Œï¼ŒHope ä¼šå°†æµ‹è¯•ä¿¡æ¯æ³¨å†Œåˆ° `currentSuite.tests` ä¸­ã€‚

### å¥—ä»¶åµŒå¥—ä¸æ ‘ç»“æ„

```ts
describe('Suite A', () => {
  test('Test A1', () => {});

  describe('Suite B', () => {
    test('Test B1', () => {});
  });
});
```

æ­¤ç»“æ„æœ€ç»ˆæ„æˆä¸€ä¸ªæ ‘ï¼š

```
root
â”œâ”€â”€ Suite A
â”‚   â”œâ”€â”€ Test A1
â”‚   â””â”€â”€ Suite B
â”‚       â””â”€â”€ Test B1
```

### é’©å­ç³»ç»Ÿä¸æ‰§è¡Œé¡ºåº

æ”¯æŒå››ç§é’©å­ï¼š`beforeAll`, `beforeEach`, `afterEach`, `afterAll`

æ‰§è¡Œé¡ºåºç¤ºæ„ï¼š

```text
A beforeAll
A beforeEach
Test A1
A afterEach
B beforeAll
A beforeEach
B beforeEach
Test B1
B afterEach
A afterEach
B afterAll
A afterAll
```
> beforeEachçš„hookä¼šä»çˆ¶åˆ°å­æ‰§è¡Œï¼Œå…·ä½“æ”¶é›†hooksçš„ä»£ç æ˜¯whileå¾ªç¯ä¸æ–­å‘çˆ¶èŠ‚ç‚¹æ”¶é›†
> ç‰¹åˆ«æ³¨æ„ï¼š`afterEach` çš„æ‰§è¡Œé¡ºåºæ˜¯åå‘çš„ï¼Œå› æ­¤éœ€è¦ `reverse()`

## ğŸ“‚ CLI æ¨¡å—ï¼ˆpray.tsï¼‰

* ä½¿ç”¨ `minimist` è§£æå‘½ä»¤è¡Œå‚æ•°
* æ ¹æ®å‚æ•°å†³å®šè¾“å‡ºæ¨¡å¼ï¼ˆterse / JSON / future HTMLï¼‰

## é”™è¯¯å¤„ç†æœºåˆ¶

æ¡†æ¶åŒºåˆ†ä¸¤ç§é”™è¯¯ï¼š

| åˆ†ç±»      | è¯´æ˜   | ç¤ºä¾‹                  |
| ------- | ---- | ------------------- |
| `fail`  | æ–­è¨€å¤±è´¥ | `assert(false)`     |
| `error` | å¼‚å¸¸ä¸­æ–­ | `throw new Error()` |

> runHooks æ–¹æ³•æœªå¤„ç†å¼‚å¸¸ï¼Œå¼‚å¸¸å°†ç”± `runSuite()` ä¸­çš„ try...catch æ•è·ã€‚

## ç”Ÿå‘½å‘¨æœŸ

```
[load tests] => [register describe/test] => [build suite tree]
         â†“
     [hope.run()]
         â†“
[runSuiteé€’å½’æ‰§è¡Œï¼Œæ¯å±‚beforeAllâ†’æµ‹è¯•â†’afterAll]
         â†“
  [ç”ŸæˆæŠ¥å‘Šï¼šconsole/json]
```

## æ€»ç»“

è¯»ä¸€ç™¾æ¬¡è¿™ä¸ªæ–‡ç« æ²¡æœ‰è‡ªå·±å†™ä¸€ä¸ªæ¥çš„å®åœ¨
